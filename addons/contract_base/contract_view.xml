<?xml version="1.0"?>
<openerp>
    <data>

        <!-- 基础菜单定义 -->
        <menuitem name="合同管理"
            web_icon="data/icon.png" web_icon_hover="data/icon-hover.png"
            id="menu_contract" sequence="20" />

        <menuitem name="合同信息" parent="menu_contract"
            id="menu_contract_info" sequence="20" />

        <menuitem name="合同执行" parent="menu_contract"
            id="menu_contract_performance" sequence="20" />

        <menuitem name="业务伙伴" parent="menu_contract"
            id="menu_contract_partner" sequence="1000" />

        <menuitem id="base.menu_address_book" name="地址簿" parent="menu_contract_partner" sequence="2" />

        <menuitem id="base.menu_product" name="标的物" 
            parent="menu_contract" sequence="2000"/>

        <menuitem name="配置" parent="menu_contract"
            id="menu_contract_config" sequence="10000" />

        <!-- ************************** 合同分组（项目）相关 *************************** -->
        <!-- 分组表单视图 -->
        <record model="ir.ui.view" id="view_group_form">
            <field name="name">contract.group.form</field>
            <field name="model">contract.group</field>
            <field name="arch" type="xml">
                <form string="合同分组">
                    <field name="name" select="1" />
                    <field name="start_date" select="1" />
                    <field name="end_date" select="1" />
                    <newline/>
                    <notebook colspan="4">
                        <page string="包含合同">
                            <field colspan="4" mode="tree,form" name="contracts" nolabel="1" widget="one2many_list" />
                        </page>
                        <page string="备注">
                            <field colspan="4" nolabel="1" name="note" select="2" />
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <!-- 分组树视图 -->
        <record model="ir.ui.view" id="view_group_tree">
            <field name="name">contract.group.tree</field>
            <field name="model">contract.group</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="分组">
                    <field name="name" />
                    <field name="start_date" />
                    <field name="end_date" />
                </tree>
            </field>
        </record>

        <!-- 分组日历视图 -->
        <record id="view_group_calendar" model="ir.ui.view">
            <field name="name">contract.group.calendar</field>
            <field name="model">contract.group</field>
            <field name="type">calendar</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar date_start="end_date" string="合同分组一览表">
                    <field name="name"/>
                </calendar>
            </field>
        </record>


        <!-- 分组动作定义 -->
        <record model="ir.actions.act_window" id="action_group_form">
            <field name="name">合同分组</field>
            <field name="res_model">contract.group</field>
            <field name="view_mode">tree,form,calendar</field>
        </record>

        <!-- 分组菜单定义 -->
        <menuitem name="合同分组" parent="menu_contract_info" sequence="2000"
            id="menu_contract_group" action="action_group_form" />


        <!-- ************************** 合同分类相关 *************************** -->
        <!-- 合同分类表单视图 -->
        <record model="ir.ui.view" id="view_contract_category_form">
            <field name="name">合同分类</field>
            <field name="model">contract.category</field>
            <field name="arch" type="xml">
                <form string="合同分类">
                    <group colspan="2" col="4">
                        <field name="name" select="1"/>
                        <field name="report_template" />
                        <newline/>
                        <field name="summary" colspan="4" />
                    </group>
                </form>
            </field>
        </record>

        <!-- 合同分类列表树视图 -->
        <record model="ir.ui.view" id="view_contract_category_tree">
            <field name="name">合同分类</field>
            <field name="model">contract.category</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="合同分类">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <!-- 合同分类动作定义 -->
        <record model="ir.actions.act_window" id="action_contract_category_form">
            <field name="name">合同分类</field>
            <field name="res_model">contract.category</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- 合同分类菜单定义 -->
        <menuitem name="合同分类" parent="menu_contract_config"
            id="menu_contract_category" action="action_contract_category_form" />


        <!-- ************************** 合同文书管理相关 *************************** -->
        <!-- 合同文书表单视图 -->
        <record model="ir.ui.view" id="view_contract_form">
            <field name="name">contract.contract.form</field>
            <field name="model">contract.contract</field>
            <field name="arch" type="xml">
                <form string="合同">
                    <field name="name" select="1" />
                    <field name="code" select="1" />
                    <newline />
                    <notebook colspan="4">
                        <page string="基本信息">
                            <field name="group" select="1" />
                            <field name="category" select="1" />
                            <newline/>
                            <field name="partner1" select="1" />
                            <field name="partner2" select="1" />
                            <field name="type" select="1" />
                            <field name="sign_date" select="1" />
                            <newline/>
                            <field name="start_date" select="1" />
                            <field name="end_date" select="1" />
                            <newline/>
                            <field colspan="4" mode="tree,form" name="lines" nolabel="1" widget="one2many_list">
                                <form string="标的物收付计划">
                                    <field colspan="4" name="name" />
                                    <field colspan="4" name="product" />
                                    <field name="uom" />
                                    <field name="quantity" />
                                    <field name="planned_date" />
                                    <newline/>
                                    <field name="note" colspan="4" />
                                </form>
                                <tree string="标的物收付计划" >
                                    <field name="name" colspan="4" />
                                    <field name="product" colspan="4" />
                                    <field name="uom" />
                                    <field name="quantity" />
                                    <field name="planned_date" />
                                </tree>
                            </field>
                            <newline/>
                            <separator colspan="4" string="状态" />
                            <field name="state" select="1" widget="statusbar" 
                                statusbar_visible="draft,confirmed,done" statusbar_colors='{"exception":"red","cancel":"red"}'/>
                        </page>
                        <page string="款项">
                            <field colspan="4" mode="tree,form" name="fund_lines" nolabel="1" widget="one2many_list">
                                <form string="收付款计划">
                                    <field colspan="4" name="name" />
                                    <field name="planned_date" />
                                    <field name="type" />
                                    <field name="payment_term" />
                                    <field name="amount" />
                                    <field name="user_id" />
                                    <newline/>
                                    <field name="note" colspan="4" />
                                </form>
                                <tree string="收付款计划" >
                                    <field name="name" colspan="4" />
                                    <field name="planned_date" />
                                    <field name="type" />
                                    <field name="payment_term" />
                                    <field name="amount" sum="计划收付总金额" />
                                    <field name="paid_amount" sum="已收付总金额" />
                                    <field name="paid_rate" widget="progressbar" />
                                </tree>
                            </field>
                            <newline/>
                            <field name="paid_rate" widget="progressbar" />
                        </page>
                        <page string="合同变更历史">
                        </page>
                        <page string="备注">
                            <field name="note" select="2" nolabel="1" />
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <!-- 合同列表树视图 -->
        <record model="ir.ui.view" id="view_contract_tree">
            <field name="name">contract.contract.tree</field>
            <field name="model">contract.contract</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="合同">
                    <field name="name" colspan="4" />
                    <field name="code" />
                    <field name="group" />
                    <field name="type" />
                    <field name="end_date" />
                    <field name="partner2" colspan="4" />
                    <field name="category" />
                    <field name="total_amount" />
                    <field name="paid_amount" />
                    <field name="paid_rate" widget="progressbar" />
                    <field name="state" />
                </tree>
            </field>
        </record>

        <!-- 合同日历视图 -->
        <record id="view_contract_calendar" model="ir.ui.view">
            <field name="name">contract.contract.calendar</field>
            <field name="model">contract.contract</field>
            <field name="type">calendar</field>
            <field name="arch" type="xml">
                <calendar color="state" date_start="end_date" string="合同一览表">
                    <field name="partner2"/>
                    <field name="name"/>
                </calendar>
            </field>
        </record>

        <!-- 合同甘特图视图 -->
        <record id="view_contract_gantt" model="ir.ui.view">
            <field name="name">contract.contract.gantt</field>
            <field name="model">contract.contract</field>
            <field name="type">gantt</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <gantt color="state" date_start="start_date" date_stop="end_date" string="合同执行情况" default_group_by="group">
                </gantt>
            </field>
        </record>

        <!-- 合同动作定义 -->
        <record model="ir.actions.act_window" id="action_contract_form">
            <field name="name">合同</field>
            <field name="res_model">contract.contract</field>
            <field name="view_mode">tree,form,calendar,gantt</field>
        </record>

        <!-- 合同菜单定义 -->
        <menuitem name="合同" parent="menu_contract_info" sequence="1000"
            id="menu_contract_contract" action="action_contract_form" />


        <!-- ************************** 合同收付款记录相关 *************************** -->
        <!-- 收付款记录表单视图 -->
        <record model="ir.ui.view" id="view_contract_fund_payment_form">
            <field name="name">合同收付款记录</field>
            <field name="model">contract.contract.fund_payment</field>
            <field name="arch" type="xml">
                <form string="合同收付款记录">
                    <group colspan="2" col="4">
                        <field name="contract" select="1" />
                        <field name="fund_line" select="1" />
                        <field name="name" select="1" />
                        <field name="pay_date" select="1" />
                        <field name="amount" select="1" />
                        <field name="user_id" select="1" />
                        <newline />
                        <field name="note" colspan="4" select="2" />
                    </group>
                </form>
            </field>
        </record>

        <!-- 收付款记录列表树视图 -->
        <record model="ir.ui.view" id="view_contract_fund_payment_tree">
            <field name="name">合同收付款记录</field>
            <field name="model">contract.contract.fund_payment</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="合同收付款记录">
                    <field name="contract" />
                    <field name="name"/>
                    <field name="pay_date" />
                    <field name="amount"/>
                </tree>
            </field>
        </record>

        <!-- 收付款记录日历视图 -->
        <record id="view_fund_payment_calendar" model="ir.ui.view">
            <field name="name">contract.contract.fund_payment.calendar</field>
            <field name="model">contract.contract.fund_payment</field>
            <field name="type">calendar</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar date_start="pay_date" string="收付款记录一览表" color="contract">
                    <field name="name"/>
                    <field name="amount"/>
                </calendar>
            </field>
        </record>

        <!-- 收付款记录动作定义 -->
        <record model="ir.actions.act_window" id="action_contract_fund_payment_form">
            <field name="name">合同收付款记录</field>
            <field name="res_model">contract.contract.fund_payment</field>
            <field name="view_mode">tree,form,calendar</field>
        </record>

        <!-- 收付款记录菜单定义 -->
        <menuitem name="收付款记录" parent="menu_contract_performance" sequence="1000"
            id="menu_contract_fund_payment" action="action_contract_fund_payment_form" />
    </data>
</openerp>

